---
title: "Julius's Final Project"
output: html_document
---
The csv file we are working with is large but no where near "big data" or anything like that. It is a summary of electricity generation and trade in the USA. Originally the idea was to specifically analyze Nuclear Power, but analyzing electricity in general has much more data and is more interesting.  In each row, the information we are analyzing is the Year/Month, Value, and Description. From this we will analyze how the value (which is billions of kilowatt hours) are related to what month of the year it is, trends over time, generation per sector for the time of year, trends about trade, and other analyses described later in comments. This data is a summary from https://www.eia.gov/electricity/data.php

A link to a pdf: https://www.eia.gov/totalenergy/data/monthly/pdf/sec7_3.pdf

```{r} 
data = read.csv(file.choose(), header = TRUE)
data
library(tidyr)
library(purrr)
library(ggplot2)
library(dplyr)
library(rmarkdown)
```
This is importing the file and loading the libraries we are going to use
```{r} 
data[,3] <- as.numeric(as.character(unlist(data[[3]])))
data <- na.omit(data)
data <- compact(data)
data
```
This cleans up the values column and removes non-data
```{r} 
spData <- spread(data,Description,Value)
spData
spDreset <- spData
```
Using spread allows us to separate the values by Description

```{r} 
dYearTotal <- keep(spData[,2],substr(data[,2],5,7) == "13")
dYearTotal
```
Data that contains a 13 is data for the entire year, as the format is YYYYMM. Because this is an entire year and not just a month, it is a lot bigger than other values. This is a list of the years of yearly data. 
```{r} 
dMonths <- discard(data[,2],substr(data[,2],5,7) == "13")
dMonths
```
This is list of the same as above but for months
```{r} 
dYearL <- substr(dYearTotal,1,4)
dYearL
```

This is a list of the first four characters in the year column, which because it is YYYYMM we get the year
```{r} 
dMonthL <- substr(dMonths,5,7)
dMonthL

```

Same concept as above, though it takes the month (MM)
```{r} 
expData <- arrange(data,desc(Value))
expData 
```
This rearranges the data so the largest energy values are 
```{r} 
ex266 <- expData[1:266,]
ex266
```
This takes the first 266 rows, which contains data that is purely from entire year; we can compare this to the other methods used to get the year only data
```{r} 
expYear <- keep(expData[,2],substr(data[,2],5,7) == "13")
expYear
```
This is the rearranged list of values , but only the year data
```{r} 
expYearL <- substr(expData[,2],1,4)
expYearL
```
This is the rearranged list of values, but only the year data using a different method
```{r} 
expMonthL <- substr(expData[,2],5,6)
expMonthL
```
This is the rearranged data, but only the year data
```{r} 
pByMonth <- map2_dfr(expMonthL, expData[,3], ~ tibble(A = .x, B = .y))
pByMonth
```
List of values and list of months
```{r} 
pByYear1 <- map2_dfr(ex266$YYYYMM, ex266$Value, ~ tibble(A = .x, B = .y))
pByYear1
```
List of values and list of years
```{r} 
pByYear2 <- map2_dfr(expYearL, expData[,3], ~ tibble(A = .x, B = .y))
pByYear2 <- pByYear2[267:7074,]
pByYear2
```
This is the same idea as the previous dataframe but using a different methodology
```{r} 
aD <- na.omit(map2_dfr(spData$`Electricity Direct Use`,spData$YYYYMM,~ tibble(A = .x, B = .y)))
aD
```
Combining these ideas, we get the values of direct energy use
```{r} 
bD <- na.omit(map2_dfr(spData$`Electricity Direct Use`,substr(spData[,2],5,6),~ tibble(ElectricityUse = .x, Month = .y)))
bD
bD <- arrange(bD,desc(Month))
bD <- bD[33:411,]
```
Now we can use some of the previous concepts to create visualizations like this, which is direct energy use by months of the year
```{r} 
graph1 <- ggplot(bD ,aes(ElectricityUse,Month)) +geom_violin() + theme_dark() + labs(x = "Billions of Kilowatts", y = "Month", title = "Direct use of energy in the USA by Month") 
```
Now we finally have something that shows us something. 
```
```
```{r} 
graph1
```
```{r} 



cD <- na.omit(map2_dfr(spData$`Electricity Exports`,substr(spData[,2],5,6),~ tibble(Exp = .x, Month = .y)))
cD
cD <- arrange(cD,desc(Month))
cD
cD <- cD[72:643,]
g2 <- ggplot(cD ,aes(Exp,Month)) +geom_violin() + theme_dark() + labs(x = "Billions of Kilowatts", y = "Month", title = "Energy exports in the USA by Month from 1950-2020") 
```
```{r} 
g2
```
```{r} 

```
The next series of visualizations describe themselves. In addition, in order to render the graphs, 
```{r} 
dD <- na.omit(map2_dfr(spData$`Electricity Imports`,substr(spData[,2],5,6),~ tibble(Exp = .x, Month = .y)))
dD
dD <- arrange(dD,desc(Month))
dD <- dD[72:643,]
dD
g3 <- ggplot(dD ,aes(Exp,Month)) +geom_violin() + theme_dark() + labs(x = "Billions of Kilowatts", y = "Month", title = "Energy imports in the USA by Month from 1950-2020") 
```
```{r} 
g3
```
```{r} 

eD <- na.omit(map2_dfr(spData$`Electricity Net Generation, Total`,substr(spData[,2],5,6),~ tibble(Exp = .x, Month = .y)))
eD
eD <- arrange(eD,desc(Month))
eD <- eD[72:643,]
g4 <- ggplot(eD ,aes(Exp,Month)) +geom_violin() + theme_dark() + labs(x = "Billions of Kilowatts", y = "Month", title = "Energy net Generation in the USA by Month from 1950-2020") 
```
```{r} 
g4
```
```{r} 

fD <- na.omit(map2_dfr(spData$`Transmission and Distribution Losses and Unaccounted for`,substr(spData[,2],5,6),~ tibble(Exp = .x, Month = .y)))
fD
fD <- arrange(fD,desc(Month))
fD <- fD[72:643,]
g5 <- ggplot(fD ,aes(Exp,Month)) +geom_violin() + theme_dark() + labs(x = "Billions of Kilowatts", y = "Month", title = "Energy Loss in the USA by Month from 1950-2020") 
```
```{r} 
g5
```
```{r} 
```
The next visualizations will be by year
```{r} 
hD <- na.omit(map2_dfr(spData$`Electricity Direct Use`,substr(spData[,2],1,4),~ tibble(Exp = .x, Year = .y)))
hD
hD <- arrange(hD,desc(Exp))
hD <- hD[32:411,]
hD
g6 <- ggplot(hD ,aes(Year,Exp), inherit.aes = FALSE) +geom_jitter() + theme_classic() + labs(y = "Billions of Kilowatts", x = "Year" , title = "Energy Use in the USA by Year from 1970-2020") +  scale_x_discrete(breaks=c(1950, 1960, 1970, 1980, 1990, 2000, 2010, 2020))
```
```{r} 
g6
```
```{r} 
```
This graph is actually pretty interesting

```{r} 
iD <- na.omit(map2_dfr(spData$`Electricity Exports`,substr(spData[,2],1,4),~ tibble(Exp = .x, Year = .y)))
iD
iD <-arrange(iD,desc(Exp))
iD <- iD[40:622,]
g7 <- ggplot(iD ,aes(Year,Exp)) +geom_jitter() + theme_classic() + labs(y = "Billions of Kilowatts", x = "Year" , title = "Energy import in the USA by Year from 1970-2020") +  scale_x_discrete(breaks=c(1970, 1980, 1990, 2000, 2010, 2020))
```
```{r} 
g7
```
```{r} 

jD <- na.omit(map2_dfr(spData$`Electricity Imports`,substr(spData[,2],1,4),~ tibble(Exp = .x, Year = .y)))
jD
jD <- arrange(jD,desc(Year))
jD <- jD[1:619,]
jD <- arrange(jD,desc(Exp))
jD <- jD[48:619,]
g8 <- ggplot(jD ,aes(Year,Exp)) +geom_jitter() + theme_classic() + labs(y = "Billions of Kilowatts", x = "Year" , title = "Energy export in the USA by Year from 1970-2020") +  scale_x_discrete(breaks=c( 1970, 1980, 1990, 2000, 2010, 2020))
```
```{r} 
g8
```
```{r} 
kD <- na.omit(map2_dfr(spData$`Electricity Net Generation, Total`,substr(spData[,2],1,4),~ tibble(Exp = .x, Year = .y)))
kD
kD <- arrange(kD,desc(Year))
kD
kD <- kD[1:619,]
kD <- arrange(kD,desc(Exp))
kD
kD <- kD[58:619,]
kD
g9 <- ggplot(kD ,aes(Year,Exp)) +geom_jitter() + theme_classic() + labs(y = "Billions of Kilowatts", x = "Year" , title = "Energy Generation in the USA by Year from 1970-2020") +  scale_x_discrete(breaks=c(1970, 1980, 1990, 2000, 2010, 2020))
```
```{r} 
g9
```
```{r} 

zD <- na.omit(map2_dfr(spData$`Transmission and Distribution Losses and Unaccounted for`,substr(spData[,2],1,4),~ tibble(Exp = .x, Year = .y)))
zD
zD <- arrange(zD,desc(Year))
zD
zD <- zD[1:619,]
zD <- arrange(zD,desc(Exp))
zD <-  zD[48:619,]
g10 <- ggplot(kD ,aes(Year,Exp)) +geom_jitter() + theme_classic() + labs(y = "Billions of Kilowatts", x = "Year" , title = "Energy Loss in the USA by Year from 1970-2020") +  scale_x_discrete(breaks=c(1970, 1980, 1990, 2000, 2010, 2020))
```
```{r} 
g10
```


